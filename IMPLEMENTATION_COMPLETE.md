# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ (FINAL)

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `margin_percent` (INTEGER, 0-100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20%)
- ‚úÖ –°–æ–∑–¥–∞–Ω –∏–Ω–¥–µ–∫—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –§–∞–π–ª: `migrations/009_add_margin_percent.sql`

### 2. –ü–∞—Ä—Å–µ—Ä—ã –Ω–∞ Playwright
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –Ω–∞ Playwright (browser automation)
- ‚úÖ Wildberries: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `window.__WBLB_INITIAL_DATA__` –∏ DOM
- ‚úÖ Ozon: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `window.__APP_STATE__` –∏ DOM
- ‚úÖ –Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `window.__INITIAL_DATA__` –∏ JSON-LD
- ‚úÖ –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ JS –ø–µ—Ä–µ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ playwright

### 3. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ü–µ–Ω–æ–∫
- ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (0-100%)
- ‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∞–º–∏ –≤ —Å–ø–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Ü–µ–Ω–∫–∏
- ‚úÖ –ù–∞—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω

### 4. UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü–æ–ª–µ "–ù–∞—Ü–µ–Ω–∫–∞ (%)" –≤ —Ñ–æ—Ä–º–µ —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö)
- ‚úÖ –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞—Ü–µ–Ω–∫–∏
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –Ω–∞—Ü–µ–Ω–∫–∏ –≤ —Å–ø–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤

### 5. –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –Ω–∞—Ü–µ–Ω–∫–∏ –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö 20%
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞—Ü–µ–Ω–∫–∏

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### Python –ø–∞—Ä—Å–µ—Ä—ã
- `parsers/base.py` - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å Playwright
- `parsers/wildberries.py` - –ü–∞—Ä—Å–µ—Ä Wildberries
- `parsers/ozon.py` - –ü–∞—Ä—Å–µ—Ä Ozon
- `parsers/yandex_market.py` - –ü–∞—Ä—Å–µ—Ä –Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç
- `parsers/__init__.py` - –§–∞–±—Ä–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤

### Frontend
- `src/types/index.ts` - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `margin_percent`
- `src/components/admin/ProductForm.tsx` - –ü–æ–ª–µ –Ω–∞—Ü–µ–Ω–∫–∏ –≤ —Ñ–æ—Ä–º–µ
- `src/components/admin/ProductsManager.tsx` - –ú–∞—Å—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∞–º–∏
- `src/lib/priceUpdateService.ts` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –Ω–∞—Ü–µ–Ω–∫–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `migrations/009_add_margin_percent.sql` - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –Ω–∞—Ü–µ–Ω–∫–∏

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
playwright install chromium
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor
\i migrations/009_add_margin_percent.sql
```

### 3. –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞
```bash
python api_server.py
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–∞
1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"
2. –í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä (Wildberries/Ozon/–Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç)
3. –ù–∞–∂–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20%)
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä

### –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏
1. –í —Å–ø–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤—ã–±—Ä–∞—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (—á–µ–∫–±–æ–∫—Å—ã)
2. –ù–∞–∂–∞—Ç—å "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É"
3. –í–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 0% –¥–æ 100%
4. –ù–∞–∂–∞—Ç—å "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
5. –¶–µ–Ω—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω
- –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—ã" –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- –ù–∞—Ü–µ–Ω–∫–∞ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Å–µ—Ä–∞
```python
{
  "title": str,
  "price": float,  # –¶–µ–Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
  "old_price": float,
  "description": str,
  "category": str,
  "characteristics": dict,
  "composition": str,
  "images": list[str],
  "in_stock": bool
}
```

### –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã
```
–¶–µ–Ω–∞ –Ω–∞ —Å–∞–π—Ç–µ = –¶–µ–Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ √ó (1 + margin_percent / 100)
```

### –ü–æ–ª—è –≤ –ë–î
- `is_imported` - —Ñ–ª–∞–≥ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- `source_url` - URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Å–∫—Ä—ã—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤)
- `margin_percent` - –Ω–∞—Ü–µ–Ω–∫–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (0-100)
- `last_price_check_at` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–Ω—ã

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Playwright —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞**: `playwright install chromium`
2. **–ü–∞—Ä—Å–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ** –Ω–∞ MacBook –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. **–ù–∞—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–æ–≤–∞—Ä–∞–º**
4. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω –Ω–∞—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –∏ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
5. **–ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã** —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

- ‚úÖ Browser automation —á–µ—Ä–µ–∑ Playwright
- ‚úÖ –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ JS
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö JS-–æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç—Ä–µ—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ (0-100%)
- ‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- ‚úÖ –°–∫—Ä—ã—Ç–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
