<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApp Initialization Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Telegram WebApp Initialization Test</h1>
        
        <div id="telegram-status" class="status info">
            –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp...
        </div>
        
        <div class="log" id="console-log">
            <strong>–õ–æ–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:</strong><br>
        </div>
        
        <div>
            <button onclick="testTelegramInit()">üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç</button>
            <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            <button onclick="simulateTelegram()">üì± –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å Telegram</button>
        </div>
        
        <div style="margin-top: 20px;">
            <h3>–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:</h3>
            <ul>
                <li>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ Telegram WebApp API</li>
                <li>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç React)</li>
                <li>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º—è–≥–∫–æ–π –∑–∞—â–∏—Ç—ã –æ—Ç —Å–≤–∞–π–ø–æ–≤</li>
                <li>–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</li>
                <li>–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤</li>
            </ul>
        </div>
    </div>

    <!-- –°–∏–º—É–ª—è—Ü–∏—è Telegram WebApp API -->
    <script>
        // –°–∏–º—É–ª—è—Ü–∏—è Telegram WebApp –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function createMockTelegramWebApp() {
            window.Telegram = {
                WebApp: {
                    ready: function() {
                        log('‚úÖ Telegram WebApp ready() called');
                    },
                    expand: function() {
                        log('üì± Telegram WebApp expand() called');
                        this.isExpanded = true;
                    },
                    isExpanded: false,
                    viewportHeight: 600,
                    enableClosingConfirmation: function() {
                        log('üîí Closing confirmation enabled (swipe protection)');
                    },
                    disableClosingConfirmation: function() {
                        log('üîì Closing confirmation disabled');
                    },
                    requestFullscreen: function() {
                        log('üñ•Ô∏è Fullscreen mode requested');
                        this.isFullscreen = true;
                    },
                    exitFullscreen: function() {
                        log('ü™ü Fullscreen mode exited');
                        this.isFullscreen = false;
                    },
                    isFullscreen: false,
                    disableVerticalSwipes: function() {
                        log('üîí Vertical swipes disabled (new API)');
                    },
                    enableVerticalSwipes: function() {
                        log('üîì Vertical swipes enabled');
                    },
                    onEvent: function(eventType, callback) {
                        log(`üì° Event listener added: ${eventType}`);
                    },
                    offEvent: function(eventType, callback) {
                        log(`üì° Event listener removed: ${eventType}`);
                    },
                    initDataUnsafe: {
                        user: {
                            id: 123456789,
                            username: 'testuser',
                            first_name: 'Test',
                            last_name: 'User'
                        }
                    },
                    MainButton: {
                        show: function() { log('üîò Main button shown'); },
                        hide: function() { log('üîò Main button hidden'); },
                        setText: function(text) { log(`üîò Main button text: ${text}`); },
                        onClick: function(callback) { log('üîò Main button click handler set'); }
                    },
                    BackButton: {
                        show: function() { log('‚¨ÖÔ∏è Back button shown'); },
                        hide: function() { log('‚¨ÖÔ∏è Back button hidden'); },
                        onClick: function(callback) { log('‚¨ÖÔ∏è Back button click handler set'); }
                    }
                }
            };
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message) {
            const logElement = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('console-log').innerHTML = '<strong>–õ–æ–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:</strong><br>';
        }

        function simulateTelegram() {
            createMockTelegramWebApp();
            log('üé≠ Telegram WebApp API —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω');
            testTelegramInit();
        }

        // –ö–æ–ø–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –∏–∑ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function getTelegramWebApp() {
            if (typeof window === 'undefined') return null;
            return window.Telegram?.WebApp || null;
        }

        function isTelegramWebApp() {
            return getTelegramWebApp() !== null;
        }

        function enableFullscreenMode() {
            const tg = getTelegramWebApp();
            if (!tg) {
                log('‚ùå Telegram WebApp not available for fullscreen mode');
                return false;
            }

            try {
                log('üöÄ Enabling fullscreen mode...');
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã (–Ω–æ–≤—ã–π API)
                if (tg.disableVerticalSwipes) {
                    tg.disableVerticalSwipes();
                } else {
                    log('‚ö†Ô∏è disableVerticalSwipes not available - using fallback methods');
                }
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                if (tg.requestFullscreen) {
                    tg.requestFullscreen();
                }
                
                // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                tg.expand();
                
                // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
                if (tg.enableClosingConfirmation) {
                    tg.enableClosingConfirmation();
                } else {
                    log('‚ö†Ô∏è enableClosingConfirmation not available');
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º CSS –∑–∞—â–∏—Ç—É
                document.body.style.overscrollBehavior = 'none';
                document.body.style.overscrollBehaviorX = 'none';
                document.body.style.overscrollBehaviorY = 'none';
                document.documentElement.style.overscrollBehavior = 'none';
                document.documentElement.style.overscrollBehaviorX = 'none';
                document.documentElement.style.overscrollBehaviorY = 'none';
                log('üîí Overscroll behavior blocked (CSS protection)');
                
                // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∂–µ—Å—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞
                document.body.style.webkitTouchCallout = 'none';
                document.body.style.webkitUserSelect = 'none';
                document.body.style.webkitTapHighlightColor = 'transparent';
                log('üö´ Browser gestures disabled');
                
                return true;
            } catch (error) {
                log(`‚ùå Failed to enable fullscreen mode: ${error.message}`);
                return false;
            }
        }

        function initTelegramWebApp() {
            const tg = getTelegramWebApp();
            if (!tg) {
                log('‚ùå Telegram WebApp not available for initialization');
                return;
            }

            log('üöÄ Initializing Telegram WebApp with fullscreen mode...');

            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebApp –°–ù–ê–ß–ê–õ–ê
                tg.ready();
                
                // –î–∞–µ–º –≤—Ä–µ–º—è React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
                setTimeout(() => {
                    log('‚è∞ Applying Telegram WebApp restrictions after React initialization...');
                    
                    // –í–∫–ª—é—á–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                    enableFullscreenMode();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ Telegram
                    if (tg.MainButton) {
                        tg.MainButton.hide();
                    }
                    
                    if (tg.BackButton) {
                        tg.BackButton.hide();
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è viewport
                    if (tg.viewportHeight) {
                        document.documentElement.style.setProperty('--tg-viewport-height', `${tg.viewportHeight}px`);
                        log(`üìè Viewport height set to: ${tg.viewportHeight}px`);
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                    document.body.classList.add('telegram-fullscreen');
                    document.body.classList.add('telegram-env');
                    document.documentElement.classList.add('telegram-fullscreen');
                    document.documentElement.classList.add('telegram-env');
                    log('üé® Telegram CSS classes applied');
                    
                    log('‚úÖ Telegram WebApp initialized successfully with soft protection');
                }, 1000); // –î–∞–µ–º 1 —Å–µ–∫—É–Ω–¥—É React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                
            } catch (error) {
                log(`‚ùå Failed to initialize Telegram WebApp: ${error.message}`);
            }
        }

        function testTelegramInit() {
            log('üß™ Starting Telegram WebApp initialization test...');
            
            const statusElement = document.getElementById('telegram-status');
            
            if (isTelegramWebApp()) {
                statusElement.className = 'status success';
                statusElement.textContent = '‚úÖ Telegram WebApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω!';
                log('‚úÖ Telegram WebApp API detected');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                initTelegramWebApp();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    const tg = getTelegramWebApp();
                    if (tg) {
                        log(`üìä Status check - Expanded: ${tg.isExpanded}, Fullscreen: ${tg.isFullscreen}`);
                        log('‚úÖ Test completed successfully!');
                    }
                }, 2000);
                
            } else {
                statusElement.className = 'status error';
                statusElement.textContent = '‚ùå Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω';
                log('‚ùå Telegram WebApp API not detected');
                log('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å Telegram" –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            log('üåê Page loaded, starting test...');
            testTelegramInit();
        });
    </script>
</body>
</html>