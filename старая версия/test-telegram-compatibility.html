<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram API Compatibility Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
        button {
            background: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Telegram WebApp API Compatibility Test</h1>
    <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Telegram WebApp API</p>
    
    <div>
        <button onclick="testApiCompatibility()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API</button>
        <button onclick="testFullscreenMethods()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã</button>
        <button onclick="testSwipeMethods()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å–≤–∞–π–ø–æ–≤</button>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div id="log" class="log"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'error' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function isMethodAvailable(obj, methodName) {
            return obj && typeof obj[methodName] === 'function';
        }

        function detectTelegramApiVersion(tg) {
            if (isMethodAvailable(tg, 'requestFullscreen')) {
                return '7.0+';
            } else if (isMethodAvailable(tg, 'disableVerticalSwipes')) {
                return '6.1+';
            } else if (isMethodAvailable(tg, 'enableClosingConfirmation')) {
                return '6.0+';
            } else if (isMethodAvailable(tg, 'expand')) {
                return '5.0+';
            } else {
                return 'unknown';
            }
        }

        function testApiCompatibility() {
            log('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ API...');
            
            if (!window.Telegram || !window.Telegram.WebApp) {
                log('‚ùå Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            const tg = window.Telegram.WebApp;
            const version = detectTelegramApiVersion(tg);
            log(`üì± –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤–µ—Ä—Å–∏—è Telegram WebApp API: ${version}`, 'success');

            const methods = [
                'ready',
                'expand', 
                'enableClosingConfirmation',
                'disableClosingConfirmation',
                'disableVerticalSwipes',
                'enableVerticalSwipes', 
                'requestFullscreen',
                'exitFullscreen',
                'onEvent',
                'offEvent'
            ];

            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Ç–æ–¥–æ–≤:');
            methods.forEach(method => {
                const available = isMethodAvailable(tg, method);
                const status = available ? '‚úÖ' : '‚ùå';
                const logType = available ? 'success' : 'warning';
                log(`  ${method}: ${status}`, logType);
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞
            const properties = ['isExpanded', 'isFullscreen', 'viewportHeight'];
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–≤–æ–π—Å—Ç–≤:');
            properties.forEach(prop => {
                const available = tg[prop] !== undefined;
                const status = available ? '‚úÖ' : '‚ùå';
                const value = available ? ` (${tg[prop]})` : '';
                const logType = available ? 'success' : 'warning';
                log(`  ${prop}: ${status}${value}`, logType);
            });
        }

        function testFullscreenMethods() {
            log('üñ•Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞...');
            
            if (!window.Telegram || !window.Telegram.WebApp) {
                log('‚ùå Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            const tg = window.Telegram.WebApp;

            // –¢–µ—Å—Ç requestFullscreen
            if (isMethodAvailable(tg, 'requestFullscreen')) {
                try {
                    tg.requestFullscreen();
                    log('‚úÖ requestFullscreen() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ requestFullscreen(): ${error.message}`, 'error');
                }
            } else {
                log('‚ö†Ô∏è requestFullscreen() –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏', 'warning');
            }

            // –¢–µ—Å—Ç expand (fallback)
            try {
                tg.expand();
                log('‚úÖ expand() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ (fallback)', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ expand(): ${error.message}`, 'error');
            }
        }

        function testSwipeMethods() {
            log('üëÜ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–∞–π–ø–∞–º–∏...');
            
            if (!window.Telegram || !window.Telegram.WebApp) {
                log('‚ùå Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'error');
                return;
            }

            const tg = window.Telegram.WebApp;

            // –¢–µ—Å—Ç disableVerticalSwipes
            if (isMethodAvailable(tg, 'disableVerticalSwipes')) {
                try {
                    tg.disableVerticalSwipes();
                    log('‚úÖ disableVerticalSwipes() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ disableVerticalSwipes(): ${error.message}`, 'error');
                }
            } else {
                log('‚ö†Ô∏è disableVerticalSwipes() –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏', 'warning');
                log('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS fallback: overscroll-behavior: none', 'info');
            }

            // –¢–µ—Å—Ç enableClosingConfirmation
            if (isMethodAvailable(tg, 'enableClosingConfirmation')) {
                try {
                    tg.enableClosingConfirmation();
                    log('‚úÖ enableClosingConfirmation() –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ enableClosingConfirmation(): ${error.message}`, 'error');
                }
            } else {
                log('‚ö†Ô∏è enableClosingConfirmation() –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏', 'warning');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç...');
            setTimeout(() => {
                testApiCompatibility();
            }, 1000);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
        }
    </script>
</body>
</html>