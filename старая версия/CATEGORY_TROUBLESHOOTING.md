# Устранение проблем с категориями товаров

## Проблема
Не удается добавлять или удалять категории при создании карточки товара.

## Диагностика

### 1. Проверка базы данных ✅
```bash
node scripts/check-categories.js
```
**Результат**: Система категорий готова к использованию!

### 2. Проверка компонентов ✅
- `CategoryManager.tsx` - компонент управления категориями
- `ProductForm.tsx` - форма создания/редактирования товара
- Типы `ProductCategory` определены корректно

### 3. Возможные причины проблемы

#### A. Проблемы с уведомлениями (Toast)
**Симптом**: Категории не добавляются, нет уведомлений об ошибках
**Решение**: Проверить импорт `sonner` и наличие `<Toaster />` в App.tsx

#### B. Проблемы с состоянием React
**Симптом**: Интерфейс не обновляется после добавления категории
**Решение**: Проверить обновление состояния в `CategoryManager`

#### C. Проблемы с Supabase подключением
**Симптом**: Ошибки в консоли браузера
**Решение**: Проверить переменные окружения в `.env`

## Пошаговое устранение

### Шаг 1: Проверка в браузере
1. Откройте http://localhost:3001/admin
2. Откройте консоль браузера (F12)
3. Попробуйте создать новый товар
4. Проверьте, есть ли ошибки в консоли

### Шаг 2: Проверка категорий напрямую
1. Откройте http://localhost:3001/test-categories.html
2. Настройте подключение к Supabase (см. инструкции на странице)
3. Попробуйте добавить/удалить категории

### Шаг 3: Проверка компонента CategoryManager
Если проблема в интерфейсе админ-панели:

```typescript
// В CategoryManager.tsx проверьте:
1. Загружаются ли категории (loadCategories)
2. Работает ли добавление (handleAddCategory)
3. Отображаются ли toast уведомления
```

### Шаг 4: Проверка ProductForm
```typescript
// В ProductForm.tsx проверьте:
1. Передается ли selectedCategoryId в CategoryManager
2. Вызывается ли onCategorySelect при выборе категории
3. Сохраняется ли category_id при создании товара
```

## Быстрые исправления

### Исправление 1: Перезапуск с очисткой кэша
```bash
# Остановить сервер (Ctrl+C)
rm -rf node_modules/.vite
npm run dev
```

### Исправление 2: Проверка переменных окружения
```bash
# Убедитесь, что .env содержит:
VITE_SUPABASE_URL=your_actual_url
VITE_SUPABASE_ANON_KEY=your_actual_key
```

### Исправление 3: Принудительное обновление компонента
Добавьте в CategoryManager.tsx временный лог:
```typescript
useEffect(() => {
  console.log('CategoryManager mounted, loading categories...');
  loadCategories();
}, []);
```

## Тестовые файлы
- `test-categories.html` - прямое тестирование API категорий
- `debug-categories.html` - диагностика системы
- `scripts/check-categories.js` - проверка базы данных

## Если проблема не решается

1. **Проверьте консоль браузера** на наличие ошибок JavaScript
2. **Проверьте Network tab** в DevTools на наличие неудачных запросов к Supabase
3. **Проверьте Supabase Dashboard** - есть ли данные в таблице `product_categories`
4. **Попробуйте создать категорию напрямую** через SQL в Supabase Dashboard:

```sql
INSERT INTO product_categories (name, description) 
VALUES ('Тестовая категория', 'Описание тестовой категории');
```

## Контакты для поддержки
Если проблема не решается, предоставьте:
1. Скриншот консоли браузера с ошибками
2. Результат выполнения `node scripts/check-categories.js`
3. Описание точных шагов, которые приводят к проблеме