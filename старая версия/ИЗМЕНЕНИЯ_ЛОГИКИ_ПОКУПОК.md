# Изменения логики покупок

## Текущая ситуация
- Товары можно добавлять напрямую в корзину
- Наборы можно добавлять в корзину
- В админ панели нет детальной информации о составе заказа

## Новые требования

### 1. Логика добавления товаров
- ❌ **Отдельные товары** (type='product') → НЕЛЬЗЯ добавлять напрямую в корзину
- ✅ **Отдельные товары** (type='product') → МОЖНО добавлять только в набор
- ✅ **Наборы** (type='bundle') → МОЖНО добавлять в корзину

### 2. Админ панель - детали заказа
- Показывать полный список товаров в заказе
- Для каждого товара показывать:
  - Название
  - Изображение
  - Цена
  - Количество
  - Артикул (SKU)
  - Общая стоимость позиции

## Изменения в коде

### 1. ProductCard.tsx
**Изменить:**
- Убрать кнопку "В корзину" для товаров (type='product')
- Оставить только кнопку "Добавить в набор" для товаров
- Для наборов (type='bundle') оставить кнопку "В корзину"

**Было:**
```tsx
{showAddToCart && (
  <Button onClick={handleAddToCart}>
    В корзину
  </Button>
)}
```

**Станет:**
```tsx
{/* Для наборов - кнопка "В корзину" */}
{showAddToCart && product.type === 'bundle' && (
  <Button onClick={handleAddToCart}>
    В корзину
  </Button>
)}

{/* Для товаров - только кнопка "В набор" */}
{product.type === 'product' && (
  <Button onClick={handleAddToBundle}>
    Добавить в набор
  </Button>
)}
```

### 2. ProductDetailPage.tsx
**Изменить:**
- Убрать кнопку "Добавить в корзину" для товаров
- Показывать только "Добавить в набор" для товаров
- Для наборов показывать "Добавить в корзину"

### 3. CartContext.tsx
**Добавить валидацию:**
```typescript
addItem(product: Product) {
  // Проверка: можно добавлять только наборы
  if (product.type !== 'bundle') {
    throw new Error('В корзину можно добавлять только наборы')
  }
  // ... остальная логика
}
```

### 4. Админ панель - OrdersManager.tsx
**Добавить:**
- Модальное окно с деталями заказа
- Таблицу товаров в заказе
- Информацию о каждом товаре

**Структура:**
```tsx
<Dialog>
  <DialogContent>
    <h2>Заказ #{order.id}</h2>
    
    {/* Информация о клиенте */}
    <div>
      <p>Клиент: {order.customer_name}</p>
      <p>Email: {order.customer_email}</p>
      <p>Телефон: {order.customer_phone}</p>
    </div>
    
    {/* Список товаров */}
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>Изображение</TableHead>
          <TableHead>Название</TableHead>
          <TableHead>Артикул</TableHead>
          <TableHead>Цена</TableHead>
          <TableHead>Кол-во</TableHead>
          <TableHead>Сумма</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {order.items.map(item => (
          <TableRow key={item.product_id}>
            <TableCell>
              <img src={item.image} alt={item.name} />
            </TableCell>
            <TableCell>{item.name}</TableCell>
            <TableCell>{item.sku}</TableCell>
            <TableCell>{item.price}₽</TableCell>
            <TableCell>{item.quantity}</TableCell>
            <TableCell>{item.price * item.quantity}₽</TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
    
    {/* Итого */}
    <div>
      <p>Итого: {order.total}₽</p>
    </div>
  </DialogContent>
</Dialog>
```

### 5. Обновить OrderItem interface
**Добавить поля:**
```typescript
export interface OrderItem {
  product_id: string;
  name: string;
  price: number;
  quantity: number;
  image?: string;
  sku?: string; // ← ДОБАВИТЬ
  description?: string; // ← ДОБАВИТЬ (опционально)
}
```

## Порядок внедрения

1. ✅ Обновить типы (OrderItem) - ГОТОВО
2. ✅ Изменить ProductCard - убрать кнопку "В корзину" для товаров - ГОТОВО
3. ✅ Изменить ProductDetailPage - убрать кнопку "В корзину" для товаров - ГОТОВО
4. ✅ Добавить валидацию в CartContext - ГОТОВО
5. ✅ Создать компонент OrderDetailsModal для админ панели - ГОТОВО
6. ✅ Обновить OrdersManager - добавить кнопку "Детали" и модальное окно - ГОТОВО
7. ⏳ Тестирование - ТРЕБУЕТСЯ

## Тестирование

### Проверить:
1. ❌ Нельзя добавить товар (type='product') в корзину
2. ✅ Можно добавить товар в набор
3. ✅ Можно добавить набор (type='bundle') в корзину
4. ✅ В админ панели видны все детали заказа
5. ✅ Список товаров отображается корректно

## Примечания

- Существующие заказы могут не иметь полной информации о товарах
- Нужно обеспечить обратную совместимость
- При создании заказа сохранять полную информацию о товарах (включая SKU, изображение)
