# Тестирование системы отзывов

## Подготовка

### 1. Настройка Storage (если еще не сделано)
```bash
node scripts/setup-review-storage.js
```

Или вручную в Supabase Dashboard:
1. Storage → Create bucket → `review-photos`
2. Settings: Public, 10 MB limit
3. Allowed MIME types: image/jpeg, image/png, image/webp

### 2. Проверка миграции
Убедитесь, что миграция `005_add_reviews_system.sql` применена:
```bash
node scripts/apply-reviews-migration.js
```

## Тестирование функций

### 1. Просмотр отзывов
1. Откройте любой товар в каталоге
2. Перейдите на вкладку "Отзывы"
3. Должна отображаться форма для добавления отзыва (если авторизованы)
4. Если отзывов нет, должно быть сообщение "Пока нет отзывов"

### 2. Добавление отзыва
1. Авторизуйтесь через Telegram WebApp
2. Откройте товар → вкладка "Отзывы"
3. Поставьте оценку (1-5 звезд) - обязательно
4. Напишите комментарий (необязательно)
5. Добавьте до 3 фото (необязательно)
6. Нажмите "Отправить отзыв"
7. Должно появиться уведомление "Отзыв отправлен на модерацию"
8. Отзыв должен появиться со статусом "На модерации"

### 3. Редактирование отзыва
1. После добавления отзыва должна появиться кнопка "Редактировать"
2. Нажмите "Редактировать"
3. Измените оценку, комментарий или фото
4. Нажмите "Сохранить изменения"
5. Должно появиться уведомление "Отзыв обновлен"
6. Редактирование доступно только в течение 24 часов

### 4. Удаление отзыва
1. В карточке своего отзыва нажмите кнопку удаления (корзина)
2. Подтвердите удаление
3. Должно появиться уведомление "Отзыв удален"
4. Отзыв должен исчезнуть из списка

### 5. Сортировка отзывов
1. Если есть несколько отзывов, проверьте сортировку:
   - По дате (новые сначала)
   - По рейтингу (высокие оценки сначала)
   - С фотографиями (только отзывы с фото)

### 6. Пагинация
1. Если отзывов больше 10, должна появиться пагинация
2. Проверьте переключение между страницами
3. При переходе на другую страницу должен быть скролл вверх

### 7. Просмотр фото
1. Нажмите на миниатюру фото в отзыве
2. Должно открыться полноэкранное изображение
3. Нажмите на фон, чтобы закрыть

## Проверка ограничений

### Валидация формы
- ❌ Нельзя отправить отзыв без оценки
- ✅ Можно отправить отзыв только с оценкой (без комментария)
- ✅ Комментарий до 1000 символов
- ✅ Максимум 3 фото

### Валидация фото
- ❌ Файлы больше 10 МБ должны быть отклонены
- ❌ Неподдерживаемые форматы (не JPG/PNG/WEBP) должны быть отклонены
- ✅ Фото должны автоматически сжиматься до 5 МБ

### Ограничения по отзывам
- ✅ Один отзыв на товар от пользователя
- ✅ После добавления отзыва форма скрывается
- ✅ Редактирование доступно только в течение 24 часов
- ✅ Можно редактировать и удалять только свои отзывы

## Проверка статистики

1. После одобрения отзыва админом:
   - Счетчик отзывов должен увеличиться
   - Средний рейтинг должен обновиться
   - Отзыв должен появиться в списке

2. После удаления отзыва:
   - Счетчик отзывов должен уменьшиться
   - Средний рейтинг должен пересчитаться

## Известные ограничения

1. **Модерация**: Отзывы автоматически не одобряются, требуется админ панель
2. **Уведомления**: Пользователи не получают уведомления о статусе отзыва
3. **Анонимность**: Отзывы не анонимные, показывается имя пользователя Telegram

## Следующие шаги

1. Создать админ панель для модерации отзывов
2. Создать страницу аналитики товаров
3. Добавить возможность админу отвечать на отзывы
4. Настроить автоматическое одобрение отзывов (опционально)

## Troubleshooting

### Отзыв не отправляется
- Проверьте авторизацию через Telegram
- Проверьте, что миграция применена
- Проверьте консоль браузера на ошибки

### Фото не загружаются
- Проверьте, что bucket `review-photos` создан
- Проверьте, что bucket публичный
- Проверьте размер и формат файлов

### Отзывы не отображаются
- Проверьте, что отзывы одобрены (status = 'approved')
- Проверьте RLS политики в Supabase
- Проверьте консоль браузера на ошибки
