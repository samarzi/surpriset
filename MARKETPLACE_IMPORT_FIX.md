# Исправление импорта товаров из маркетплейсов

## Проблемы

1. **CORS ошибка в браузере** - прямые запросы к API маркетплейсов блокируются CORS политикой
2. **Неточные данные при импорте** - HTML парсинг не извлекал правильные данные товара
3. **Ненадежный прокси** - `allorigins.win` возвращал ошибки 500

## Решение

Использование **публичных API маркетплейсов через надежный CORS-прокси** (`corsproxy.io`):

### Wildberries
- **API**: `https://card.wb.ru/cards/v1/detail`
- **Прокси**: `https://corsproxy.io/`
- **Преимущества**:
  - Точные данные напрямую из API
  - Правильные цены (в копейках, конвертируются в рубли)
  - Корректные изображения по стандартному формату WB
  - Характеристики товара из структурированных данных
  - Информация о составе товара

### Ozon
- **API**: `https://www.ozon.ru/api/composer-api.bx/page/json/v2`
- **Прокси**: `https://corsproxy.io/`
- **Преимущества**:
  - Прямой доступ к данным товара
  - Структурированные характеристики
  - Точные цены и изображения

### Яндекс Маркет
- **API**: `https://market.yandex.ru/api/resolve/`
- **Прокси**: `https://corsproxy.io/`
- **Преимущества**:
  - Надежное получение данных
  - Полная информация о товаре
  - Спецификации и характеристики

## Технические изменения

### Файл: `src/lib/marketplaceParsers.ts`

1. **Добавлены методы извлечения ID товара** из URL для каждого маркетплейса
2. **Используется надежный CORS-прокси** `corsproxy.io` вместо `allorigins.win`
3. **Прямые запросы к API** маркетплейсов через прокси
4. **Улучшена обработка данных**:
   - Правильная конвертация цен (копейки → рубли для WB)
   - Формирование URL изображений по стандартам маркетплейсов
   - Извлечение характеристик из структурированных данных API
   - Поддержка состава/комплектации товара
5. **Оптимизировано время ожидания** - 15 секунд (API быстрее HTML)

## Результат

✅ **Импорт работает в браузере** - CORS-прокси решает проблему  
✅ **Импорт работает в Telegram** - данные точные и соответствуют товару  
✅ **Быстрее** - API отвечает быстрее, чем загрузка HTML  
✅ **Надежнее** - структурированные данные вместо парсинга HTML  
✅ **Проект собран** - сборка прошла успешно без ошибок

## Как использовать

1. Откройте админ-панель
2. Перейдите в раздел "Товары"
3. Вставьте ссылку на товар из Wildberries, Ozon или Яндекс Маркет
4. Нажмите "Загрузить"
5. Данные загрузятся автоматически с наценкой 20%
6. Проверьте и отредактируйте данные при необходимости
7. Нажмите "Создать товар"

## Поддерживаемые форматы ссылок

- **Wildberries**: `https://www.wildberries.ru/catalog/315215210/detail.aspx`
- **Ozon**: `https://www.ozon.ru/product/название-123456789/`
- **Яндекс Маркет**: `https://market.yandex.ru/product--название/123456789`

## Что импортируется

- ✅ Название товара
- ✅ Цена (с автоматической наценкой 20%)
- ✅ Старая цена (если есть скидка)
- ✅ Описание
- ✅ Изображения (до 10 штук)
- ✅ Характеристики
- ✅ Состав/комплектация (для WB)
- ✅ Статус наличия

## Примечания

- Импорт работает как в браузере, так и в Telegram Mini App
- Цены автоматически увеличиваются на 20% (наценка)
- Можно редактировать любые данные после импорта
- SKU генерируется автоматически в формате `IMP-{timestamp}`
