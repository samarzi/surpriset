# Ozon Price Import Fix - Kopecks Issue ‚úÖ

## Problem
–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –û–∑–æ–Ω–∞ —Ü–µ–Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å 2 –Ω—É–ª—è –≤ –∫–æ–Ω—Ü–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–≤–∞—Ä –∑–∞ 1999‚ÇΩ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª—Å—è –∫–∞–∫ 199900‚ÇΩ.

## Root Cause
–û–∑–æ–Ω –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ü–µ–Ω—É –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö:
- –í —Ä—É–±–ª—è—Ö: `1999`
- –í –∫–æ–ø–µ–π–∫–∞—Ö: `199900` (1999 * 100)

–°—Ç–∞—Ä—ã–π –∫–æ–¥ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª —Ñ–æ—Ä–º–∞—Ç –∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∫ –µ—Å—Ç—å, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∏–º–ø–æ—Ä—Ç—É —Ü–µ–Ω –≤ –∫–æ–ø–µ–π–∫–∞—Ö.

## Solution
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalize_price()` –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç —Ü–µ–Ω—ã:
- –ï—Å–ª–∏ —Ü–µ–Ω–∞ > 10000, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –æ–Ω–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö –∏ –¥–µ–ª–∏–º –Ω–∞ 100
- –ï—Å–ª–∏ —Ü–µ–Ω–∞ ‚â§ 10000, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å (–≤ —Ä—É–±–ª—è—Ö)

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `parsers/ozon.py`

#### 1. –§—É–Ω–∫—Ü–∏—è `_extract_price()`
–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—ã:
```python
def normalize_price(price_val):
    """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ü–µ–Ω—É - –µ—Å–ª–∏ –æ–Ω–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö (> 10000), –¥–µ–ª–∏–º –Ω–∞ 100"""
    if price_val <= 0:
        return 0
    # –ï—Å–ª–∏ —Ü–µ–Ω–∞ –±–æ–ª—å—à–µ 10000, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –æ–Ω–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
    if price_val > 10000:
        normalized = price_val / 100
        print(f"üîß Ozon: –¶–µ–Ω–∞ {price_val} –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∫–æ–ø–µ–π–∫–∏, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ {normalized}‚ÇΩ")
        return normalized
    return price_val
```

–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ü–µ–Ω—ã:
- `product_data["price"]`
- `product_data["finalPrice"]`
- `product_data["salePrice"]`
- DOM –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ —Ü–µ–Ω—ã

#### 2. –§—É–Ω–∫—Ü–∏—è `_extract_old_price()`
–¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ä–æ–π —Ü–µ–Ω—ã:
- `product_data["oldPrice"]`
- `product_data["originalPrice"]`

#### 3. JSON-LD –ø–∞—Ä—Å–∏–Ω–≥
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `_extract_product_data()`:
```python
if json_ld['offers'].get('price'):
    price = float(json_ld['offers']['price'])
    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ü–µ–Ω—É - –µ—Å–ª–∏ –±–æ–ª—å—à–µ 10000, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
    if price > 10000:
        price = price / 100
        print(f"üîß Ozon JSON-LD: –¶–µ–Ω–∞ {json_ld['offers']['price']} –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∫–æ–ø–µ–π–∫–∏, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ {price}‚ÇΩ")
    product_data['price'] = int(price)
```

## Examples

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –¢–æ–≤–∞—Ä –∑–∞ 1999‚ÇΩ ‚Üí –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ 199900‚ÇΩ ‚ùå
- –¢–æ–≤–∞—Ä –∑–∞ 5490‚ÇΩ ‚Üí –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ 549000‚ÇΩ ‚ùå

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –¢–æ–≤–∞—Ä –∑–∞ 1999‚ÇΩ (–≤ –∫–æ–ø–µ–π–∫–∞—Ö 199900) ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ 1999‚ÇΩ ‚úÖ
- –¢–æ–≤–∞—Ä –∑–∞ 5490‚ÇΩ (–≤ –∫–æ–ø–µ–π–∫–∞—Ö 549000) ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ 5490‚ÇΩ ‚úÖ
- –¢–æ–≤–∞—Ä –∑–∞ 999‚ÇΩ (–≤ —Ä—É–±–ª—è—Ö 999) ‚Üí –æ—Å—Ç–∞—ë—Ç—Å—è 999‚ÇΩ ‚úÖ

## Logging
–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- `üîç` - –ø–æ–∏—Å–∫ —Ü–µ–Ω—ã –≤ –¥–∞–Ω–Ω—ã—Ö
- `üîß` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ –∫–æ–ø–µ–µ–∫
- `‚úÖ` - —É—Å–ø–µ—à–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–Ω—ã
- `‚ö†Ô∏è` - —Ü–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

## Testing
–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–≤–∞—Ä —Å –û–∑–æ–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ü–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è (–Ω–µ —É–º–Ω–æ–∂–µ–Ω–∞ –Ω–∞ 100)

## Files Modified
- `parsers/ozon.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω

## Backward Compatibility
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –¢–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–æ–π –≤ —Ä—É–±–ª—è—Ö (‚â§ 10000) —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- –¢–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–æ–π –≤ –∫–æ–ø–µ–π–∫–∞—Ö (> 10000) —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
- –ü–æ—Ä–æ–≥ 10000‚ÇΩ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç 99% —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –û–∑–æ–Ω–µ
