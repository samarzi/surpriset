# Чеклист деплоя: Система отзывов

## Перед деплоем

### 1. Локальное тестирование
- [ ] Создан Storage bucket `review-photos`
- [ ] Применена миграция `005_add_reviews_system.sql`
- [ ] Протестировано добавление отзыва
- [ ] Протестировано редактирование отзыва
- [ ] Протестировано удаление отзыва
- [ ] Протестирована загрузка фото
- [ ] Протестирована модерация отзывов
- [ ] Протестирована аналитика товаров
- [ ] Проверена сортировка и пагинация
- [ ] Проект собирается без ошибок (`npm run build`)

### 2. Проверка кода
- [ ] Нет TypeScript ошибок
- [ ] Нет console.log в продакшн коде
- [ ] Все компоненты оптимизированы
- [ ] Изображения сжимаются корректно
- [ ] RLS политики настроены правильно

## Настройка продакшн Supabase

### 3. База данных
- [ ] Применена миграция `005_add_reviews_system.sql`
- [ ] Проверены триггеры (update_product_stats)
- [ ] Проверены RLS политики для таблицы `reviews`
- [ ] Обновлена таблица `products` (reviews_count, average_rating)

```sql
-- Проверка таблицы reviews
SELECT * FROM reviews LIMIT 1;

-- Проверка триггеров
SELECT * FROM pg_trigger WHERE tgname LIKE '%review%';

-- Проверка RLS политик
SELECT * FROM pg_policies WHERE tablename = 'reviews';
```

### 4. Storage
- [ ] Создан bucket `review-photos`
- [ ] Bucket настроен как публичный
- [ ] Установлен лимит 10 МБ
- [ ] Разрешены форматы: JPG, PNG, WEBP
- [ ] Настроены RLS политики для Storage

**Создание bucket:**
```bash
# Через скрипт (требуется SUPABASE_SERVICE_ROLE_KEY)
node scripts/setup-review-storage.js
```

**Или вручную в Dashboard:**
1. Storage → Create bucket
2. Name: `review-photos`
3. Public: ✅
4. File size limit: 10485760 (10 MB)
5. Allowed MIME types: image/jpeg, image/png, image/webp

### 5. Переменные окружения
- [ ] `VITE_SUPABASE_URL` - URL продакшн проекта
- [ ] `VITE_SUPABASE_ANON_KEY` - Anon key продакшн проекта
- [ ] `SUPABASE_SERVICE_ROLE_KEY` - Service role key (только для скриптов)

## Деплой

### 6. Сборка и деплой
- [ ] Обновлены переменные окружения
- [ ] Выполнена сборка: `npm run build`
- [ ] Проверен размер бандла
- [ ] Загружены файлы на хостинг
- [ ] Проверена работа на продакшн URL

### 7. Проверка после деплоя
- [ ] Открывается главная страница
- [ ] Работает навигация
- [ ] Открывается страница товара
- [ ] Отображается вкладка "Отзывы"
- [ ] Можно добавить отзыв
- [ ] Фото загружаются корректно
- [ ] Админ панель доступна
- [ ] Модерация отзывов работает
- [ ] Аналитика товаров работает

## Мониторинг

### 8. После запуска
- [ ] Настроен мониторинг ошибок (Sentry, LogRocket)
- [ ] Проверяются логи Supabase
- [ ] Мониторится использование Storage
- [ ] Отслеживается количество отзывов
- [ ] Проверяется скорость загрузки страниц

### 9. Регулярные задачи
- [ ] Модерация новых отзывов (ежедневно)
- [ ] Ответы на отзывы пользователей
- [ ] Проверка аналитики товаров
- [ ] Очистка отклоненных отзывов (опционально)
- [ ] Резервное копирование фото (еженедельно)

## Оптимизация

### 10. Производительность
- [ ] Настроен CDN для изображений
- [ ] Включено кэширование
- [ ] Оптимизированы запросы к БД
- [ ] Настроена пагинация
- [ ] Включено lazy loading для фото

### 11. Безопасность
- [ ] RLS политики активны
- [ ] Валидация на клиенте и сервере
- [ ] Защита от спама (rate limiting)
- [ ] Модерация обязательна
- [ ] Фото проходят валидацию

## Troubleshooting

### Частые проблемы

**Отзывы не сохраняются:**
- Проверьте RLS политики
- Проверьте, что пользователь авторизован
- Проверьте логи Supabase

**Фото не загружаются:**
- Проверьте, что bucket создан
- Проверьте, что bucket публичный
- Проверьте RLS политики Storage
- Проверьте размер и формат файлов

**Медленная загрузка:**
- Включите CDN
- Оптимизируйте изображения
- Настройте кэширование
- Проверьте индексы БД

**Ошибки в админке:**
- Проверьте пароль (8985)
- Очистите localStorage
- Проверьте права доступа

## Контакты поддержки

- Документация: `REVIEWS_COMPLETE.md`
- Тестирование: `REVIEWS_TESTING.md`
- Быстрый старт: `QUICK_START_REVIEWS.md`

## Статус

- [ ] Все пункты выполнены
- [ ] Система протестирована
- [ ] Готово к продакшн

---

**Дата деплоя:** _________________

**Ответственный:** _________________

**Версия:** 1.0.0
